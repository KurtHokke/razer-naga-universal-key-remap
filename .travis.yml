language: rust
rust:
- stable
before_install:
- sudo apt update
- sudo apt install -y libudev-dev
stages:
- build
- name: publish-github
  if: tag =~ ^v
- name: publish-crate
  if: tag =~ ^v
jobs:
  include:
  - stage: build
    script: cargo build
  - stage: publish-crate
    script: cargo login "$CRATES_TOKEN"
  - stage: publish-crate
    script: cargo package
  - stage: publish-crate
    script: cargo publish
  - stage: publish-github
    script: cargo build --release
    deploy:
      provider: releases
      api_key: "$GITHUB_API_KEY"
      file: target/release/razer-naga-2014-key-remap
      skip_cleanup: true

